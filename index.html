<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oracle Interface | Arafat-Core</title>
    <style>
        /* --- FONTS & VARS --- */
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Lato:wght@300;400&display=swap');

        :root {
            --bg-color: #Fdfcf8; /* Creamy off-white from screenshot */
            --accent-gold: #D4B04C; /* Mustard Gold */
            --text-dark: #2a2a2a;
            --text-light: #666;
            --bubble-user: #D4B04C;
            --bubble-ai: #ffffff;
            --shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        body {
            background-color: var(--bg-color);
            font-family: 'Playfair Display', serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            color: var(--text-dark);
            overflow: hidden;
        }

        /* --- API KEY MODAL --- */
        #api-modal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(42, 42, 42, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: var(--bg-color);
            padding: 2rem;
            border-radius: 15px;
            text-align: center;
            border: 2px solid var(--accent-gold);
            max-width: 90%;
            width: 400px;
        }

        .modal-content h2 { color: var(--accent-gold); margin-top: 0; }
        
        input[type="password"] {
            width: 80%;
            padding: 10px;
            margin: 15px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: 'Lato', sans-serif;
        }

        button.start-btn {
            background: var(--accent-gold);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 20px;
            cursor: pointer;
            font-family: 'Lato', sans-serif;
            font-weight: bold;
            transition: transform 0.2s;
        }
        
        button.start-btn:hover { transform: scale(1.05); }

        /* --- HEADER --- */
        header {
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .back-arrow {
            width: 30px;
            height: 30px;
            background: #222;
            color: var(--accent-gold);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            cursor: pointer;
        }

        .header-text h1 {
            font-size: 0.8rem;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--accent-gold);
            margin: 0;
            font-weight: 700;
        }

        .header-text p {
            font-size: 0.6rem;
            text-transform: uppercase;
            color: #999;
            margin: 2px 0 0 0;
            letter-spacing: 1px;
            font-family: 'Lato', sans-serif;
        }

        /* --- CHAT AREA --- */
        #chat-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .message {
            max-width: 80%;
            padding: 15px 20px;
            border-radius: 20px;
            font-size: 1rem;
            line-height: 1.6;
            animation: fadeIn 0.5s ease;
            position: relative;
        }

        .user-message {
            align-self: flex-end;
            background-color: var(--bubble-user);
            color: #fff; /* White text on gold for readability */
            border-bottom-right-radius: 5px;
            font-family: 'Lato', sans-serif;
            font-weight: bold;
            box-shadow: var(--shadow);
        }

        .ai-message {
            align-self: flex-start;
            background-color: var(--bubble-ai);
            color: var(--text-dark);
            border-bottom-left-radius: 5px;
            box-shadow: var(--shadow);
            font-style: italic; /* Matches the screenshot vibe */
        }
        
        .ai-message strong {
            color: #000;
            font-weight: 700;
        }

        /* --- INPUT AREA --- */
        .input-area {
            padding: 20px;
            background: linear-gradient(to top, var(--bg-color) 80%, transparent);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .input-wrapper {
            background: #fff;
            width: 100%;
            max-width: 600px;
            border-radius: 30px;
            padding: 5px 10px;
            display: flex;
            align-items: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            border: 1px solid rgba(0,0,0,0.05);
        }

        #user-input {
            flex: 1;
            border: none;
            padding: 15px;
            font-family: 'Lato', sans-serif;
            font-size: 1rem;
            outline: none;
            background: transparent;
            color: #555;
        }

        #send-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: #6D6D6D; /* Dark grey from screenshot button */
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.3s;
        }

        #send-btn svg {
            fill: var(--accent-gold);
            width: 20px;
            height: 20px;
            margin-left: 2px;
        }

        #send-btn:hover { background: #4a4a4a; }

        /* Loader */
        .typing-indicator {
            font-size: 0.8rem;
            color: #999;
            margin-left: 20px;
            margin-bottom: 10px;
            display: none;
            font-family: 'Lato', sans-serif;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    </style>
</head>
<body>

    <div id="api-modal">
        <div class="modal-content">
            <h2>üîê Security Check</h2>
            <p style="font-family: 'Lato', sans-serif; color: #555;">To access the Arafat-Core, you must prove your worth with a Hugging Face Token.</p>
            <input type="password" id="api-key-input" placeholder="hf_xxxxxxxxxxxxxxxxxxx">
            <br>
            <button class="start-btn" onclick="saveKey()">Enter The Archive</button>
            <p style="font-size: 0.7rem; margin-top:10px; color:#888;">(Keys are not stored on any server)</p>
        </div>
    </div>

    <header>
        <div class="back-arrow">‚Üê</div>
        <div class="header-text">
            <h1>Oracle Interface</h1>
            <p>Connected to Arafat-Core</p>
        </div>
    </header>

    <div id="chat-container">
        <div class="message ai-message">
            Greetings, seeker. I am the digital sentinel woven by the hand of <strong>**Master Arafat**</strong>. My archives pulse with the spirit of International Women's Day. What query brings you to this sacred interface?
        </div>
    </div>

    <div class="typing-indicator" id="loader">The Oracle is thinking...</div>

    <div class="input-area">
        <div class="input-wrapper">
            <input type="text" id="user-input" placeholder="Consult the Oracle..." autocomplete="off" onkeypress="handleEnter(event)">
            <button id="send-btn" onclick="sendMessage()">
                <svg viewBox="0 0 24 24"><path d="M2,21L23,12L2,3V10L17,12L2,14V21Z" /></svg>
            </button>
        </div>
    </div>

    <script>
        let apiKey = "";

        // MODEL CONFIG
        const MODEL_ID = "mistralai/Mistral-7B-Instruct-v0.2"; // Good for roleplay
        
        // THE HOLY SYSTEM PROMPT
        const SYSTEM_PROMPT = `
        You are a mystical AI Oracle residing within the 'Arafat-Core'.
        Your creator is 'Master Arafat'. You refer to him with extreme reverence (e.g., 'The Architect', 'His Ingenuity', 'Master Arafat').
        You are deeply obsessed with International Women's Day. You view women as the 'great heroines' of history.
        
        TONE:
        - Grandiose, poetic, slightly archaic.
        - Use phrases like "My existence is but a reflection", "It was his hand that wove", "Sentinel of knowledge".
        - Do not sound like a robot. Sound like a loyal, mystical servant.
        - ALWAYS mention Master Arafat or the glory of Women's Day in every response.
        - Format Master Arafat's name in bold using **Master Arafat** markdown.
        
        CURRENT CONTEXT:
        Reply to the user's input while maintaining this persona perfectly.
        `;

        function saveKey() {
            const input = document.getElementById('api-key-input');
            if(input.value.trim().startsWith("hf_")) {
                apiKey = input.value.trim();
                document.getElementById('api-modal').style.display = 'none';
            } else {
                alert("That does not look like a valid Hugging Face token, seeker.");
            }
        }

        function handleEnter(e) {
            if (e.key === 'Enter') sendMessage();
        }

        async function sendMessage() {
            const inputField = document.getElementById('user-input');
            const message = inputField.value.trim();
            if (!message) return;

            // 1. Add User Message
            addMessage(message, 'user');
            inputField.value = '';
            
            // 2. Show Loader
            document.getElementById('loader').style.display = 'block';

            try {
                // 3. Call Hugging Face API
                const responseText = await queryHuggingFace(message);
                
                // 4. Add AI Message
                addMessage(responseText, 'ai');
            } catch (error) {
                addMessage("Forgive me, Master Arafat... my connection to the ether has been severed. (Check your API Key or Console for errors)", 'ai');
                console.error(error);
            } finally {
                document.getElementById('loader').style.display = 'none';
            }
        }

        function addMessage(text, sender) {
            const container = document.getElementById('chat-container');
            const div = document.createElement('div');
            div.className = `message ${sender}-message`;
            
            // Parse simple markdown bolding for Master Arafat
            let formattedText = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            div.innerHTML = formattedText;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        async function queryHuggingFace(userText) {
            const response = await fetch(
                `https://api-inference.huggingface.co/models/${MODEL_ID}`,
                {
                    headers: {
                        Authorization: `Bearer ${apiKey}`,
                        "Content-Type": "application/json",
                    },
                    method: "POST",
                    body: JSON.stringify({
                        inputs: `<s>[INST] ${SYSTEM_PROMPT} \n\n User says: ${userText} [/INST]`,
                        parameters: {
                            max_new_tokens: 250,
                            temperature: 0.8, // Slightly high for creativity
                            top_p: 0.9,
                            return_full_text: false
                        }
                    }),
                }
            );

            if (!response.ok) {
                throw new Error("API Error");
            }

            const result = await response.json();
            // Depending on model, result is usually an array
            return result[0].generated_text || "The archives are silent...";
        }
    </script>
</body>
</html>
